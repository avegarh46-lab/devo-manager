<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DEVO Organization Manager</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK Compat -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { background-color: #020617; color: white; font-family: 'Plus Jakarta Sans', sans-serif; }
        .glass { background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.05); }
        .nav-center { transform: translateY(-15px); box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.5); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Konfigurasi dari Screenshot Anda
        const firebaseConfig = {
            apiKey: "AIzaSyC7-l7LkpXzdebsGINhg49zPy3XAEtqtUw",
            authDomain: "devo-manager.firebaseapp.com",
            projectId: "devo-manager",
            storageBucket: "devo-manager.firebasestorage.app",
            messagingSenderId: "622771552963",
            appId: "1:622771552963:web:73af8de96d646fb1da1876",
            measurementId: "G-2KE1DXB30E"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const { useState, useEffect } = React;

        function App() {
            const [activeTab, setActiveTab] = useState('home');
            const [isAdmin, setIsAdmin] = useState(false);
            const [loading, setLoading] = useState(true);
            const [data, setData] = useState({
                saldo: 0,
                members: [],
                transactions: [],
                proker: [],
                berita: []
            });

            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];

            useEffect(() => {
                const unsubFinance = db.collection("settings").doc("finance").onSnapshot(doc => {
                    if (doc.exists) setData(prev => ({...prev, saldo: doc.data().saldo || 0}));
                    setLoading(false);
                });

                const unsubMembers = db.collection("members").orderBy("id", "asc").onSnapshot(snap => {
                    setData(prev => ({...prev, members: snap.docs.map(d => ({idDoc: d.id, ...d.data()}))}));
                });

                const unsubTrx = db.collection("transactions").orderBy("date", "desc").limit(10).onSnapshot(snap => {
                    setData(prev => ({...prev, transactions: snap.docs.map(d => ({idDoc: d.id, ...d.data()}))}));
                });

                const unsubProker = db.collection("proker").orderBy("date", "desc").onSnapshot(snap => {
                    setData(prev => ({...prev, proker: snap.docs.map(d => ({idDoc: d.id, ...d.data()}))}));
                });

                const unsubBerita = db.collection("berita").orderBy("date", "desc").onSnapshot(snap => {
                    setData(prev => ({...prev, berita: snap.docs.map(d => ({idDoc: d.id, ...d.data()}))}));
                });

                return () => { unsubFinance(); unsubMembers(); unsubTrx(); unsubProker(); unsubBerita(); };
            }, []);

            // FUNGSI INPUT DATA (ADMIN ONLY)
            const addTransaction = async () => {
                const ket = prompt("Keterangan Transaksi:");
                const total = parseInt(prompt("Jumlah (Angka saja):"));
                const tipe = prompt("Tipe (masuk/keluar):").toLowerCase();
                
                if (ket && total && (tipe === 'masuk' || tipe === 'keluar')) {
                    const newSaldo = tipe === 'masuk' ? data.saldo + total : data.saldo - total;
                    await db.collection("transactions").add({
                        ket, total, tipe, date: firebase.firestore.Timestamp.now()
                    });
                    await db.collection("settings").doc("finance").set({ saldo: newSaldo });
                }
            };

            const addBerita = async () => {
                const judul = prompt("Judul Berita:");
                const isi = prompt("Isi Pengumuman:");
                if (judul && isi) {
                    await db.collection("berita").add({
                        judul, isi, date: firebase.firestore.Timestamp.now()
                    });
                }
            };

            const toggleIuran = async (memberId, month, currentStatus) => {
                if (!isAdmin) return;
                const member = data.members.find(m => m.idDoc === memberId);
                const updatedPaid = { ...(member.paid || {}), [month]: !currentStatus };
                await db.collection("members").doc(memberId).update({ paid: updatedPaid });
            };

            const handleAdminToggle = () => {
                if (!isAdmin) {
                    const pin = prompt("Masukkan PIN Admin:");
                    if (pin === "2024") setIsAdmin(true);
                    else alert("PIN Salah!");
                } else {
                    setIsAdmin(false);
                }
            };

            if (loading) return <div className="h-screen flex items-center justify-center bg-slate-950 text-xs tracking-widest">MEMUAT...</div>;

            return (
                <div className="min-h-screen bg-slate-950 pb-32 max-w-md mx-auto relative">
                    {/* Header */}
                    <header className="p-6 flex justify-between items-center sticky top-0 bg-slate-950/80 backdrop-blur-md z-50 border-b border-white/5">
                        <h1 className="font-black italic text-xl uppercase tracking-tighter">DEVO <span className="text-blue-500">ORG</span></h1>
                        <button onClick={handleAdminToggle} className={`p-2 rounded-xl ${isAdmin ? 'bg-blue-600 text-white' : 'bg-slate-900 text-slate-500'}`}>
                            <i className={`fas ${isAdmin ? 'fa-unlock' : 'fa-lock'}`}></i>
                        </button>
                    </header>

                    <main className="px-6 py-4">
                        {/* TAB: BERITA */}
                        {activeTab === 'berita' && (
                            <div className="space-y-4">
                                <div className="flex justify-between items-center">
                                    <h2 className="text-[10px] font-bold text-slate-500 uppercase">Berita Devo</h2>
                                    {isAdmin && <button onClick={addBerita} className="bg-blue-600 text-[10px] px-3 py-1 rounded-lg font-bold">+ BERITA</button>}
                                </div>
                                {data.berita.map(b => (
                                    <div key={b.idDoc} className="glass p-4 rounded-2xl">
                                        <h3 className="font-bold text-sm">{b.judul}</h3>
                                        <p className="text-xs text-slate-400 mt-2">{b.isi}</p>
                                    </div>
                                ))}
                            </div>
                        )}

                        {/* TAB: PROKER */}
                        {activeTab === 'proker' && (
                            <div className="space-y-4">
                                <h2 className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Program Kerja</h2>
                                {data.proker.map(p => (
                                    <div key={p.idDoc} className="glass p-4 rounded-2xl border-l-2 border-blue-500">
                                        <div className="flex justify-between">
                                            <span className="text-xs font-bold uppercase">{p.nama}</span>
                                            <span className="text-[8px] text-blue-400 font-bold uppercase">{p.status}</span>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {/* TAB: HOME */}
                        {activeTab === 'home' && (
                            <div className="space-y-6">
                                <div className="bg-gradient-to-br from-blue-600 to-indigo-900 p-8 rounded-[2rem] shadow-xl border border-white/10">
                                    <p className="text-[9px] font-bold text-blue-200 uppercase tracking-widest">Total Kas</p>
                                    <h2 className="text-4xl font-black mt-1">Rp {data.saldo.toLocaleString('id-ID')}</h2>
                                </div>
                                
                                <div className="space-y-3">
                                    <div className="flex justify-between px-1">
                                        <h3 className="text-[10px] font-bold text-slate-500 uppercase">Aktivitas Terakhir</h3>
                                        {isAdmin && <button onClick={addTransaction} className="text-blue-500 text-[10px] font-bold">TAMBAH +</button>}
                                    </div>
                                    {data.transactions.map(t => (
                                        <div key={t.idDoc} className="glass p-4 rounded-2xl flex justify-between items-center">
                                            <div className="flex items-center gap-3">
                                                <div className={`w-8 h-8 rounded-lg flex items-center justify-center text-[10px] ${t.tipe === 'masuk' ? 'bg-green-500/10 text-green-500' : 'bg-red-500/10 text-red-500'}`}>
                                                    <i className={`fas ${t.tipe === 'masuk' ? 'fa-arrow-down' : 'fa-arrow-up'}`}></i>
                                                </div>
                                                <span className="text-xs font-bold uppercase">{t.ket}</span>
                                            </div>
                                            <span className={`text-xs font-black ${t.tipe === 'masuk' ? 'text-green-500' : 'text-red-500'}`}>
                                                {t.total.toLocaleString()}
                                            </span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* TAB: ANGGOTA */}
                        {activeTab === 'anggota' && (
                            <div className="space-y-3">
                                <h2 className="text-[10px] font-bold text-slate-500 uppercase px-1">Daftar Anggota</h2>
                                {data.members.map(m => (
                                    <div key={m.idDoc} className="glass p-4 rounded-2xl flex justify-between">
                                        <span className="text-xs font-bold uppercase">{m.name}</span>
                                        <span className="text-[10px] text-slate-500">ID: {m.id}</span>
                                    </div>
                                ))}
                            </div>
                        )}

                        {/* TAB: IURAN */}
                        {activeTab === 'iuran' && (
                            <div className="space-y-4">
                                <h2 className="text-[10px] font-bold text-slate-500 uppercase">Kontrol Iuran</h2>
                                <div className="overflow-x-auto no-scrollbar glass rounded-2xl">
                                    <table className="w-full text-left">
                                        <thead className="text-[8px] uppercase text-slate-600 border-b border-white/5">
                                            <tr>
                                                <th className="p-4 sticky left-0 bg-slate-900">Nama</th>
                                                {months.map(m => <th key={m} className="p-4">{m}</th>)}
                                            </tr>
                                        </thead>
                                        <tbody className="text-[10px]">
                                            {data.members.map(m => (
                                                <tr key={m.idDoc} className="border-b border-white/5">
                                                    <td className="p-4 font-bold uppercase sticky left-0 bg-slate-900 border-r border-white/5">{m.name}</td>
                                                    {months.map(mon => (
                                                        <td key={mon} className="p-2 text-center">
                                                            <button 
                                                                onClick={() => toggleIuran(m.idDoc, mon, m.paid?.[mon])}
                                                                className={`w-6 h-6 rounded flex items-center justify-center ${m.paid?.[mon] ? 'bg-green-600 text-white' : 'bg-slate-800 text-slate-700'}`}
                                                            >
                                                                <i className="fas fa-check text-[8px]"></i>
                                                            </button>
                                                        </td>
                                                    ))}
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* Navigasi Sesuai Request */}
                    <nav className="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-slate-900/90 backdrop-blur-xl p-4 flex justify-between items-center rounded-t-[2rem] border-t border-white/10 z-[60]">
                        <button onClick={() => setActiveTab('berita')} className={`flex-1 flex flex-col items-center gap-1 ${activeTab === 'berita' ? 'text-blue-500' : 'text-slate-600'}`}>
                            <i className="fas fa-newspaper"></i>
                            <span className="text-[7px] font-bold uppercase">Berita</span>
                        </button>
                        <button onClick={() => setActiveTab('proker')} className={`flex-1 flex flex-col items-center gap-1 ${activeTab === 'proker' ? 'text-blue-500' : 'text-slate-600'}`}>
                            <i className="fas fa-tasks"></i>
                            <span className="text-[7px] font-bold uppercase">Proker</span>
                        </button>
                        <div className="flex-1 flex justify-center">
                            <button onClick={() => setActiveTab('home')} className={`w-14 h-14 rounded-2xl flex flex-col items-center justify-center nav-center ${activeTab === 'home' ? 'bg-blue-600 text-white' : 'bg-slate-800 text-slate-500'}`}>
                                <i className="fas fa-home"></i>
                                <span className="text-[7px] font-bold uppercase mt-1">Home</span>
                            </button>
                        </div>
                        <button onClick={() => setActiveTab('anggota')} className={`flex-1 flex flex-col items-center gap-1 ${activeTab === 'anggota' ? 'text-blue-500' : 'text-slate-600'}`}>
                            <i className="fas fa-users"></i>
                            <span className="text-[7px] font-bold uppercase">Anggota</span>
                        </button>
                        <button onClick={() => setActiveTab('iuran')} className={`flex-1 flex flex-col items-center gap-1 ${activeTab === 'iuran' ? 'text-blue-500' : 'text-slate-600'}`}>
                            <i className="fas fa-coins"></i>
                            <span className="text-[7px] font-bold uppercase">Iuran</span>
                        </button>
                    </nav>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
