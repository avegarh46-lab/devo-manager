<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DEVO Organization Manager</title>
    
    <!-- UI Frameworks -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- React & Babel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        
        body { 
            background-color: #020617; 
            color: white; 
            margin: 0; 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            -webkit-tap-highlight-color: transparent; 
        }
        .glass { background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.05); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Animasi Transisi Tab */
        .fade-enter { opacity: 0; transform: translateY(10px); }
        .fade-enter-active { opacity: 1; transform: translateY(0); transition: all 0.3s ease; }
        
        /* Nav Center Button */
        .nav-center {
            transform: translateY(-20px);
            box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.5);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const firebaseConfig = {
            apiKey: "AIzaSyC7-l7LkpXzdebsGINhg49zPy3XAEtqtUw",
            authDomain: "devo-manager.firebaseapp.com",
            projectId: "devo-manager",
            storageBucket: "devo-manager.firebasestorage.app",
            messagingSenderId: "622771552963",
            appId: "1:622771552963:web:73af8de96d646fb1da1876",
            measurementId: "G-2KE1DXB30E"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const { useState, useEffect } = React;

        function App() {
            const [activeTab, setActiveTab] = useState('home');
            const [isAdmin, setIsAdmin] = useState(false);
            const [loading, setLoading] = useState(true);
            const [data, setData] = useState({
                saldo: 0,
                members: [],
                transactions: [],
                proker: [],
                berita: []
            });

            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];

            useEffect(() => {
                // Real-time Listeners
                const unsubFinance = db.collection("settings").doc("finance").onSnapshot(doc => {
                    if (doc.exists) setData(prev => ({...prev, saldo: doc.data().saldo || 0}));
                    setLoading(false);
                });

                const unsubMembers = db.collection("members").orderBy("id", "asc").onSnapshot(snap => {
                    const m = snap.docs.map(d => ({idDoc: d.id, ...d.data()}));
                    setData(prev => ({...prev, members: m}));
                });

                const unsubTrx = db.collection("transactions").orderBy("date", "desc").limit(15).onSnapshot(snap => {
                    setData(prev => ({...prev, transactions: snap.docs.map(d => ({idDoc: d.id, ...d.data()}))}));
                });

                const unsubProker = db.collection("proker").orderBy("date", "desc").onSnapshot(snap => {
                    setData(prev => ({...prev, proker: snap.docs.map(d => ({idDoc: d.id, ...d.data()}))}));
                });

                const unsubBerita = db.collection("berita").orderBy("date", "desc").onSnapshot(snap => {
                    setData(prev => ({...prev, berita: snap.docs.map(d => ({idDoc: d.id, ...d.data()}))}));
                });

                return () => { unsubFinance(); unsubMembers(); unsubTrx(); unsubProker(); unsubBerita(); };
            }, []);

            // Handle Login Admin Sederhana
            const handleAdminToggle = () => {
                if (!isAdmin) {
                    const pin = prompt("Masukkan PIN Khusus Pengurus:");
                    if (pin === "2024") { // Ganti PIN sesuai keinginan Anda
                        setIsAdmin(true);
                    } else {
                        alert("PIN Salah! Hanya Ketua, Wakil, Sekretaris, & Bendahara.");
                    }
                } else {
                    setIsAdmin(false);
                }
            };

            if (loading) return (
                <div className="min-h-screen flex items-center justify-center bg-slate-950">
                    <div className="text-center">
                        <div className="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                        <p className="text-[10px] font-bold text-slate-500 tracking-[0.2em] uppercase">Memuat Data Devo...</p>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-slate-950 pb-32 max-w-md mx-auto relative shadow-2xl border-x border-white/5">
                    
                    {/* Header Modern */}
                    <header className="px-6 py-6 flex justify-between items-center sticky top-0 bg-slate-950/80 backdrop-blur-lg z-50 border-b border-white/5">
                        <div>
                            <h1 className="font-black italic text-xl tracking-tighter uppercase leading-none">DEVO <span className="text-blue-500">ORG</span></h1>
                            <p className="text-[8px] font-bold text-slate-500 tracking-widest uppercase mt-1">Management System</p>
                        </div>
                        <button 
                            onClick={handleAdminToggle}
                            className={`p-2 rounded-xl transition-all ${isAdmin ? 'bg-green-600/20 text-green-500' : 'bg-slate-900 text-slate-500'}`}
                        >
                            <i className={`fas ${isAdmin ? 'fa-unlock' : 'fa-lock'} text-sm`}></i>
                        </button>
                    </header>

                    <main className="px-6 pt-4 animate-in fade-in duration-500">
                        
                        {/* TAB: BERITA */}
                        {activeTab === 'berita' && (
                            <section className="space-y-4">
                                <div className="flex justify-between items-center">
                                    <h2 className="text-xs font-black uppercase tracking-widest text-slate-500">Berita & Pengumuman</h2>
                                    {isAdmin && <button className="text-[10px] bg-blue-600 px-3 py-1 rounded-lg font-bold">TAMBAH</button>}
                                </div>
                                {data.berita.length === 0 && <p className="text-center py-10 text-xs text-slate-600 italic">Belum ada berita terbaru.</p>}
                                {data.berita.map(b => (
                                    <div key={b.idDoc} className="glass p-4 rounded-2xl">
                                        <p className="text-[10px] text-blue-400 font-bold mb-1 uppercase">{new Date(b.date?.toDate()).toLocaleDateString()}</p>
                                        <h3 className="font-bold text-sm leading-tight">{b.judul}</h3>
                                        <p className="text-xs text-slate-400 mt-2 line-clamp-3">{b.isi}</p>
                                    </div>
                                ))}
                            </section>
                        )}

                        {/* TAB: PROKER */}
                        {activeTab === 'proker' && (
                            <section className="space-y-4">
                                <div className="flex justify-between items-center">
                                    <h2 className="text-xs font-black uppercase tracking-widest text-slate-500">Program Kerja</h2>
                                    {isAdmin && <button className="text-[10px] bg-blue-600 px-3 py-1 rounded-lg font-bold">RENCANA BARU</button>}
                                </div>
                                {data.proker.map(p => (
                                    <div key={p.idDoc} className="glass p-5 rounded-3xl border-l-4 border-indigo-500">
                                        <div className="flex justify-between items-start">
                                            <h3 className="font-bold text-sm uppercase">{p.nama}</h3>
                                            <span className={`text-[8px] px-2 py-1 rounded-full font-black uppercase ${p.status === 'Selesai' ? 'bg-green-500/20 text-green-500' : 'bg-orange-500/20 text-orange-500'}`}>
                                                {p.status}
                                            </span>
                                        </div>
                                        <p className="text-[10px] text-slate-400 mt-2">{p.deskripsi}</p>
                                    </div>
                                ))}
                            </section>
                        )}

                        {/* TAB: HOME (CENTER) */}
                        {activeTab === 'home' && (
                            <div className="space-y-6">
                                {/* Card Saldo Transparan */}
                                <div className="bg-gradient-to-br from-blue-600 to-indigo-900 p-8 rounded-[2.5rem] shadow-2xl relative overflow-hidden border border-white/10">
                                    <div className="absolute -right-4 -top-4 w-32 h-32 bg-white/10 rounded-full blur-3xl"></div>
                                    <p className="text-[10px] font-black text-blue-100 uppercase tracking-[0.2em] opacity-70">Total Kas Organisasi</p>
                                    <h2 className="text-4xl font-black mt-2 tracking-tighter">Rp {data.saldo.toLocaleString('id-ID')}</h2>
                                    <div className="mt-6 flex gap-2">
                                        <div className="bg-white/10 px-3 py-1.5 rounded-xl text-[9px] font-bold backdrop-blur-md">
                                            {data.members.length} Anggota
                                        </div>
                                        <div className="bg-white/10 px-3 py-1.5 rounded-xl text-[9px] font-bold backdrop-blur-md">
                                            Real-time Data
                                        </div>
                                    </div>
                                </div>

                                {/* List Transaksi (Transparansi) */}
                                <div className="space-y-3">
                                    <div className="flex justify-between items-center px-1">
                                        <h3 className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Alur Kas Terbaru</h3>
                                        <i className="fas fa-history text-slate-700 text-xs"></i>
                                    </div>
                                    {data.transactions.map(t => (
                                        <div key={t.idDoc} className="glass p-4 rounded-2xl flex justify-between items-center group active:scale-95 transition-all">
                                            <div className="flex items-center gap-3">
                                                <div className={`w-9 h-9 rounded-xl flex items-center justify-center ${t.tipe === 'masuk' ? 'bg-green-500/10 text-green-400' : 'bg-red-500/10 text-red-400'}`}>
                                                    <i className={`fas ${t.tipe === 'masuk' ? 'fa-arrow-down' : 'fa-arrow-up'} text-xs`}></i>
                                                </div>
                                                <div>
                                                    <p className="text-xs font-bold uppercase tracking-tight">{t.ket}</p>
                                                    <p className="text-[8px] text-slate-500 font-bold uppercase">{new Date(t.date?.toDate()).toLocaleDateString('id-ID')}</p>
                                                </div>
                                            </div>
                                            <span className={`text-xs font-black ${t.tipe === 'masuk' ? 'text-green-500' : 'text-red-500'}`}>
                                                {t.tipe === 'masuk' ? '+' : '-'} {t.total.toLocaleString()}
                                            </span>
                                        </div>
                                    ))}
                                    {isAdmin && (
                                        <button onClick={() => alert("Gunakan Mode Admin di Versi Lengkap")} className="w-full py-4 border-2 border-dashed border-white/5 rounded-2xl text-[10px] font-black text-slate-600 uppercase hover:border-blue-500/50 hover:text-blue-500 transition-all">
                                            + Tambah Transaksi Baru
                                        </button>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* TAB: ANGGOTA */}
                        {activeTab === 'anggota' && (
                            <section className="space-y-4">
                                <h2 className="text-[10px] font-black uppercase tracking-widest text-slate-500 px-1">Database Anggota Devo</h2>
                                {data.members.map(m => (
                                    <div key={m.idDoc} className="glass p-4 rounded-2xl flex items-center justify-between">
                                        <div className="flex items-center gap-4">
                                            <div className="w-10 h-10 bg-slate-900 rounded-xl flex items-center justify-center font-black text-xs text-blue-500 border border-white/5">{m.id}</div>
                                            <div>
                                                <p className="text-sm font-black uppercase">{m.name}</p>
                                                <p className="text-[9px] text-slate-500 font-bold">{m.whatsapp || 'No WhatsApp Belum Ada'}</p>
                                            </div>
                                        </div>
                                        {m.whatsapp && (
                                            <button onClick={() => window.open(`https://wa.me/${m.whatsapp}`)} className="w-9 h-9 rounded-xl bg-green-500/10 text-green-500 flex items-center justify-center">
                                                <i className="fab fa-whatsapp"></i>
                                            </button>
                                        )}
                                    </div>
                                ))}
                            </section>
                        )}

                        {/* TAB: IURAN */}
                        {activeTab === 'iuran' && (
                            <section className="space-y-4">
                                <h2 className="text-[10px] font-black uppercase tracking-widest text-slate-500 px-1">Kontrol Iuran Bulanan</h2>
                                <div className="overflow-x-auto no-scrollbar rounded-[2rem] glass border border-white/5">
                                    <table className="w-full">
                                        <thead className="bg-slate-900/50 text-[9px] font-black uppercase text-slate-500">
                                            <tr>
                                                <th className="p-4 text-left sticky left-0 bg-slate-900 z-10 border-r border-white/5">Anggota</th>
                                                {months.map(m => <th key={m} className="p-4 text-center">{m}</th>)}
                                            </tr>
                                        </thead>
                                        <tbody className="text-[10px]">
                                            {data.members.map(m => (
                                                <tr key={m.idDoc} className="border-t border-white/5">
                                                    <td className="p-4 font-black uppercase sticky left-0 bg-slate-900 z-10 border-r border-white/5 truncate max-w-[100px]">{m.name}</td>
                                                    {months.map(mon => (
                                                        <td key={mon} className="p-2 text-center">
                                                            <div className={`w-6 h-6 mx-auto rounded-lg flex items-center justify-center ${m.paid?.[mon] ? 'bg-green-500 text-white' : 'bg-slate-800 text-slate-700 opacity-30'}`}>
                                                                <i className="fas fa-check text-[8px]"></i>
                                                            </div>
                                                        </td>
                                                    ))}
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </section>
                        )}

                    </main>

                    {/* Navigation Bar Sesuai Request */}
                    <nav className="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-slate-900/90 backdrop-blur-2xl px-4 py-4 flex justify-between items-end rounded-t-[2.5rem] border-t border-white/5 z-[60] shadow-[0_-10px_40px_rgba(0,0,0,0.5)]">
                        
                        {/* 1. Berita (Paling Kiri) */}
                        <button onClick={() => setActiveTab('berita')} className={`flex-1 flex flex-col items-center gap-1 transition-all ${activeTab === 'berita' ? 'text-blue-500 scale-110' : 'text-slate-600'}`}>
                            <i className="fas fa-newspaper text-lg"></i>
                            <span className="text-[7px] font-black uppercase tracking-tighter">Berita</span>
                        </button>

                        {/* 2. Program Kerja */}
                        <button onClick={() => setActiveTab('proker')} className={`flex-1 flex flex-col items-center gap-1 transition-all ${activeTab === 'proker' ? 'text-blue-500 scale-110' : 'text-slate-600'}`}>
                            <i className="fas fa-list-check text-lg"></i>
                            <span className="text-[7px] font-black uppercase tracking-tighter">Proker</span>
                        </button>

                        {/* 3. HOME (CENTER - Menonjol) */}
                        <div className="flex-1 flex justify-center">
                            <button 
                                onClick={() => setActiveTab('home')} 
                                className={`w-14 h-14 rounded-2xl flex flex-col items-center justify-center transition-all nav-center ${activeTab === 'home' ? 'bg-blue-600 text-white' : 'bg-slate-800 text-slate-400'}`}
                            >
                                <i className="fas fa-house text-xl"></i>
                                <span className="text-[7px] font-black uppercase mt-1">Home</span>
                            </button>
                        </div>

                        {/* 4. Anggota */}
                        <button onClick={() => setActiveTab('anggota')} className={`flex-1 flex flex-col items-center gap-1 transition-all ${activeTab === 'anggota' ? 'text-blue-500 scale-110' : 'text-slate-600'}`}>
                            <i className="fas fa-users text-lg"></i>
                            <span className="text-[7px] font-black uppercase tracking-tighter">Anggota</span>
                        </button>

                        {/* 5. Iuran (Paling Kanan) */}
                        <button onClick={() => setActiveTab('iuran')} className={`flex-1 flex flex-col items-center gap-1 transition-all ${activeTab === 'iuran' ? 'text-blue-500 scale-110' : 'text-slate-600'}`}>
                            <i className="fas fa-money-check-dollar text-lg"></i>
                            <span className="text-[7px] font-black uppercase tracking-tighter">Iuran</span>
                        </button>
                    </nav>

                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
